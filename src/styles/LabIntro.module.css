/* Full-screen solid backdrop */
.container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #0b0b0b;
  padding: var(--frame-gutter);
}

/* Screen within a screen (16:9, responsive) */
.floatingWindow {
  width: min(
    calc(100vw - (var(--frame-gutter) * 2)),
    calc((100vh - (var(--frame-gutter) * 2)) * 16 / 9)
  );
  aspect-ratio: 16 / 9;
  background: url('/Backgrounds/labIntro.webp') center / cover no-repeat;
  border: 4px solid #333;
  border-radius: 12px;
  box-shadow: 0 16px 40px rgba(0,0,0,0.6);
  overflow: hidden;
  position: relative;

  /* Enable container queries so children can use cqw/cqh */
  container-type: inline-size;
}

.windowContent {
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  padding: 32px;
  color: #f3f3f3;
  text-shadow: 0 1px 2px rgba(0,0,0,0.6);
  font-size: clamp(12px, 1.4cqw, 20px);
}

/* --- Interactive scene --- */
.catRow {
  position: absolute;
  left: clamp(12px, 2cqw, 32px);
  right: clamp(12px, 2cqw, 32px);
  bottom: clamp(12px, 3cqh, 32px);
  display: flex;
  gap: clamp(8px, 1.6cqw, 24px);
  align-items: flex-end;
}

/* Cat scales with the frame */
.catWrap {
  position: relative;
  width: clamp(220px, 24cqw, 520px);
  height: clamp(220px, 24cqw, 520px);
  display: grid;
  place-items: end;
  z-index: 2;
}

/* If you're using <img>, let it fill the catWrap cleanly */
.catSprite,
.sprite {
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
}

/* Bottom-center speech dock */
.speechDock {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: clamp(12px, 4cqh, 48px);
  width: min(80cqw, 1000px);
  z-index: 3;
}

.speechWrap {
  max-width: 100%;
  margin: 0 auto;
  display: grid;
  gap: clamp(8px, 1.2cqw, 16px);
}

/* Bubble shrinks to content, capped by frame width */
.speechBubble {
  background: #ffffff;
  color: #111;
  border: 3px solid #1f2937;
  border-radius: 16px;
  padding: clamp(10px, 1cqh, 16px) clamp(12px, 1.4cqw, 24px);
  position: relative;
  box-shadow: 0 6px 0 rgba(0,0,0,0.7);

  display: inline-block;
  width: fit-content;
  max-width: min(80cqw, 1000px);
  margin-inline: auto;
}
.speechBubble::before {
  content: '';
  position: absolute;
  left: -14px;
  bottom: 22px;
  width: 0; height: 0;
  border-top: 10px solid transparent;
  border-bottom: 10px solid transparent;
  border-right: 14px solid #fff;
}
.speechBubble::after {
  content: '';
  position: absolute;
  left: -17px;
  bottom: 19px;
  width: 0; height: 0;
  border-top: 13px solid transparent;
  border-bottom: 13px solid transparent;
  border-right: 17px solid #1f2937;
}

/* Reply choices */
.choices {
  margin-top: 0.6em;
  display: flex;
  gap: clamp(8px, 1.4cqw, 18px);
  flex-wrap: wrap;
  justify-content: center;
}
.choiceBtn {
  cursor: pointer;
  background: #ffe082;
  color: #111;
  border: 2px solid #1f2937;
  border-radius: 12px;
  padding: 0.6em 0.9em;
  font-size: clamp(13px, 1.6cqw, 22px);
  box-shadow: 0 3px 0 rgba(0,0,0,0.7);
  font-weight: 800;
}
.choiceBtn:active { transform: translateY(2px); box-shadow: 0 1px 0 rgba(0,0,0,0.7); }
.choiceBtn:disabled { opacity: .6; }

/* Interactable buttons bar */
.labBar {
  position: absolute;
  left: clamp(12px, 2cqw, 32px);
  right: clamp(12px, 2cqw, 32px);
  bottom: calc(clamp(12px, 4cqh, 48px) + 4.2em);
  display: flex;
  gap: clamp(8px, 1.2cqw, 16px);
  flex-wrap: wrap;
  justify-content: center;
}
.itemBtn {
  cursor: pointer;
  background: rgba(241,245,249,0.95);
  color: #111;
  border: 2px solid #1f2937;
  border-radius: 12px;
  padding: 0.65em 1em;
  font-size: clamp(13px, 1.6cqw, 22px);
  box-shadow: 0 3px 0 rgba(0,0,0,0.7);
  font-weight: 800;
  backdrop-filter: blur(2px);
}
.itemBtn.danger { background: #fecaca; }
.itemBtn:active { transform: translateY(2px); box-shadow: 0 1px 0 rgba(0,0,0,0.7); }

/* Lights-off overlay */
.darkOverlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: rgba(0,0,0,0.7);
  transition: background 220ms ease;
}

/* If you use CSS-sprite animation instead of <img> */
.sprite {
  background-repeat: no-repeat;
  background-position: 0 0;
  --frames: 8;
  background-size: calc(100% * var(--frames)) 100%;
  animation: sprite-play 1s steps(var(--frames)) infinite;
}
@keyframes sprite-play { to { background-position: -100% 0; } }

/* Portal FX */
.portalIdle { position: absolute; inset: 0; pointer-events:none; }
.portalStarting {
  position: absolute; inset: 0; pointer-events:none;
  background: radial-gradient(circle at 70% 30%, rgba(131, 240, 255, .45), transparent 40%),
              radial-gradient(circle at 30% 70%, rgba(173, 127, 255, .35), transparent 45%);
  animation: portal-pulse 600ms ease-in-out 2;
  mix-blend-mode: screen;
}
.portalOpen {
  position: absolute; inset: 0; pointer-events:none;
  background: radial-gradient(circle at 50% 50%, rgba(131, 240, 255, .55), transparent 35%),
              radial-gradient(circle at 50% 50%, rgba(173, 127, 255, .45), transparent 55%);
  animation: portal-vortex 1.2s ease-in-out infinite;
  mix-blend-mode: screen;
}
@keyframes portal-pulse {
  0% { transform: scale(0.98); opacity: 0.15 }
  50% { transform: scale(1.04); opacity: 0.8 }
  100% { transform: scale(1); opacity: 0.15 }
}
@keyframes portal-vortex {
  0% { transform: scale(1) rotate(0deg); opacity: .3 }
  50% { transform: scale(1.05) rotate(5deg); opacity: .6 }
  100% { transform: scale(1) rotate(0deg); opacity: .3 }
}